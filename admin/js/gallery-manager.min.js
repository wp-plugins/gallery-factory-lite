var VLS_GF=VLS_GF||{};
VLS_GF.GalleryManager=function(b){var g,h,p;function c(y,k,c,z){"all_images"==y||"unsorted_images"==y?(k=0,b("#vls-gf-tab-panel").slideUp(),"all_images"==y?c=vlsGfGalleryAdminData.l10n.strAllImages:"unsorted_images"==y&&(c=vlsGfGalleryAdminData.l10n.strUnsortedImages),b(".vls-gf-window-title > .vls-gf-shortcode").css("display","none").find("input").val("")):(b("#vls-gf-tab-panel").slideDown(),b(".vls-gf-window-title .vls-gf-shortcode").css("display","").find("input").val(z));b(".vls-gf-window-title > span").first().text(c);
g=y;h=k;p="album_overview";m(p);return!1}function m(b){b=b.replace("#","");D.append('<div class="vls-gf-loading-overlay"><span></span></div>');v.find("li").removeClass("active");v.find('a[href="#'+b+'"]:first').parent().addClass("active");switch(b){case "album_overview":VLS_GF.AlbumOverviewPanelModule.loadContent(g,h);break;case "album_layout":VLS_GF.AlbumLayoutPanelModule.loadContent(h);break;case "album_edit":VLS_GF.ItemEditPanelModule.loadContent("album",h)}return!1}function k(){return b('<div class="vls-gf-modal"><div class="vls-gf-backdrop"></div><div class="vls-gf-window"></div></div>')}
function x(){b(".vls-gf-modal").remove()}var v,D;g="unsorted_images";h=0;p="album_overview";return{init:function(){v=b("#vls-gf-tab-panel");D=b(".vls-gf-tab-view");v.find("ul > li > a").on("click.vls-gf",function(k){m(b(this).attr("href"));k.preventDefault()});VLS_GF.NavigationPanelModule.init();c(g,h)},switchAlbum:c,reloadTab:function(){m(p)},showConfirmDialog:function(y,c,p,m){var h=k(),n=h.find(".vls-gf-window");n.append('<div class="vls-gf-title"><span>'+y+"</span></div>");y=b('<div class="vls-gf-content"></div>');
n.append(y);y.append('<span class="vls-gf-message">'+c+"</span>");c=b('<div class="vls-gf-buttons-panel"></div>');n.append(c);y=b('<a class="button" href="#">Cancel</a>');y.on("click.vls-gf",x);c.append(y);p=b('<a class="button-primary" href="#"></a>').text(p);p.on("click.vls-gf",m);c.append(p);b("#wpwrap").append(h);n.css("margin-top",0-n.height()/2)},showNameDialog:function(c,p){var m="",h="",g="";"rename"===c?(m=vlsGfGalleryAdminData.l10n.strRenameHeader,h=vlsGfGalleryAdminData.l10n.strRenameAction,
g=vlsGfGalleryAdminData.l10n.strRenameLabel):"createFolder"===c?(m=vlsGfGalleryAdminData.l10n.strCreateFolderHeader,h=vlsGfGalleryAdminData.l10n.strCreateFolderAction,g=vlsGfGalleryAdminData.l10n.strCreateFolderLabel):"createAlbum"===c&&(m=vlsGfGalleryAdminData.l10n.strCreateAlbumHeader,h=vlsGfGalleryAdminData.l10n.strCreateAlbumAction,g=vlsGfGalleryAdminData.l10n.strCreateAlbumLabel);var n=k(),v=n.find(".vls-gf-window");v.append('<div class="vls-gf-title"><span>'+m+"</span></div>");m=b('<div class="vls-gf-content"></div>');
v.append(m);m.append('<label class="vls-gf-form-element"><span>'+g+'</span><input type="text" value="" /></label>');g=m.find("input");g.on("keyup.vls-gf",function(b){13==b.keyCode&&p()});m=b('<div class="vls-gf-buttons-panel"></div>');v.append(m);var e=b('<a class="button" href="#">Cancel</a>');e.on("click.vls-gf",x);m.append(e);h=b('<a class="button-primary" href="#"></a>').text(h);h.on("click.vls-gf",p);m.append(h);b("#wpwrap").append(n);v.css("margin-top",0-v.height()/2);g.focus()},closePopup:x}}(jQuery);
VLS_GF.NavigationPanelModule=function(b){function g(){b.get(ajaxurl,{action:"vls_gf_view_gallery_tree",tour:VLS_GF.TourModule&&VLS_GF.TourModule.isActive()},function(b){e.empty().append(b);e.find("li").on("click.vls-gf touchend.vls-gf",v);h();e.parent().find("li.unsorted, li.album").droppable({accept:".dragging-image",hoverClass:"drop-ready",drop:n})},"html")}function h(){a.nextItemOrder=99999;var u=0,d=100,q=!1,t=1,l=1,f=0,c=e.find("li").not(".vls-gf-deleted");c.sort(function(d,a){return parseInt(b(d).data("vlsGfOrder"))-
parseInt(b(a).data("vlsGfOrder"))});for(var C=0;C<c.length;++C){var r=b(c[C]),G=parseInt(r.data("vlsGfLevel"));G>d?(r.addClass("vls-hidden"),r.css({position:"absolute",top:(u-1)*w.height+"px"}),r.data("vlsGfPosition",u-1).attr("data-vls-gf-position",u-1)):(++f,d=100,r.removeClass("vls-hidden"),r.hasClass("folder")&&!r.hasClass("opened")&&(d=parseInt(r.data("vlsGfLevel"))),a.ghostPosition==u&&++u,r.hasClass("ui-draggable-dragging")||(r.css({top:u*w.height+"px"}),r.data("vlsGfPosition",u).attr("data-vls-gf-position",
u),u==a.ghostPosition-1?(q=r.hasClass("folder"),t=G):u==a.ghostPosition+1&&(l=G,a.nextItemOrder=parseInt(r.data("vlsGfOrder"))),++u))}a.$draggedItem&&(a.ghostLevel+=a.initialLevel,l<=t?(q&&(t+=t<(a.$draggedItem.hasClass("folder")?2:3)?1:0),a.ghostLevel>t?a.ghostLevel=t:a.ghostLevel<l&&(a.ghostLevel=l)):a.ghostLevel=l,a.ghostPosition>=f&&(a.ghostPosition=f-1),a.$draggingGhost.css("top",a.ghostPosition*w.height+"px"),a.$draggingGhost.attr("class","dragging-ghost"),a.$draggingGhost.addClass("level-"+
a.ghostLevel));e.css("height",28*f+"px")}function p(b,d){b.hasClass("opened")&&"open"!=d?(b.removeClass("opened"),h()):b.hasClass("opened")||"close"==d||(b.addClass("opened"),h())}function c(u,d){var q=b(this);a.itemTreeOffset={top:e.offset().top,left:e.offset().left};q.removeClass("opened");e.find("li").draggable("disable");a.$draggedItem=q;a.ghostPosition=Math.floor((q.offset().top-a.itemTreeOffset.top+w.middle)/w.height);a.initialLevel=parseInt(q.data("vlsGfLevel"));var t=e.find("li");t.sort(function(d,
a){return parseInt(b(d).data("vlsGfOrder"))-parseInt(b(a).data("vlsGfOrder"))});for(var l=!1,f=0;f<t.length;++f){var c=b(t[f]);parseInt(c.data("vlsGfId"));var C=parseInt(c.data("vlsGfOrder")),r=parseInt(c.data("vlsGfLevel"));parseInt(q.data("vlsGfId"));var G=parseInt(q.data("vlsGfOrder"));c.is(q)||(C>G&&r<=a.initialLevel&&!l?l=!0:C>G&&r>a.initialLevel&&!l&&c.addClass("vls-gf-dragging-child"))}e.append(a.$draggingGhost);h()}function m(u,d){var q=parseInt(d.offset.top)+w.middle;if(!(q>=a.currentArea.top&&
q<=a.currentArea.bottom&&d.offset.left>=a.currentArea.left&&d.offset.left<=a.currentArea.right)){clearTimeout(a.hoverTimeout);var t=Math.floor((q-a.itemTreeOffset.top)/w.height);0>t&&(t=0);a.ghostLevel=Math.floor((parseInt(d.offset.left)-a.itemTreeOffset.left)/10);a.currentArea.left=a.itemTreeOffset.left+10*a.ghostLevel;a.currentArea.right=a.itemTreeOffset.left+10*(a.ghostLevel+1)-1;var l=a.itemTreeOffset.top+w.height*t,q=q-l+1,f=e.find("li").filter(function(d,a){var r=b(a);return r.data("vlsGfPosition")==
t&&!r.hasClass("vls-hidden")&&!r.hasClass("ui-draggable-dragging")});f&&f.hasClass("folder")&&!f.hasClass("opened")?t>a.ghostPosition&&q>w.bottomPart?(a.ghostPosition=t,a.currentArea.top=l,a.currentArea.bottom=l+w.height-1):t<a.ghostPosition&&q<=w.topPart?(a.ghostPosition=t,a.currentArea.top=l,a.currentArea.bottom=l+w.height-1):(t>a.ghostPosition?(a.currentArea.top=l,a.currentArea.bottom=l+w.bottomPart):(a.currentArea.top=l+w.topPart,a.currentArea.bottom=l+w.height-1),a.hoverTimeout=setTimeout(function(){p(f,
"open")},500)):(a.ghostPosition=t,a.currentArea.top=l,a.currentArea.bottom=l+w.height-1);h()}}function k(){var a=b(this);a.addClass("ui-draggable-placing");setTimeout(function(){a.removeClass("ui-draggable-placing")},550);return!1}function x(u,d){var q=!1,t=b(this),l=e.find("li").not(".vls-gf-dragging-child, .ui-draggable-dragging");l.sort(function(d,a){var r=b(d),f=b(a);return 1E5*parseInt(r.data("vlsGfPosition"))+parseInt(r.data("vlsGfOrder"))-1E5*parseInt(f.data("vlsGfPosition"))-parseInt(f.data("vlsGfOrder"))});
var f=e.find("li.vls-gf-dragging-child");f.sort(function(d,a){return parseInt(b(d).data("vlsGfOrder"))-parseInt(b(a).data("vlsGfOrder"))});for(var c=0,C=0;C<=l.length;++C){if(C<l.length)var r=b(l[C]);++c;if(!q&&(C==l.length&&99999==a.nextItemOrder||r.hasClass("vls-gf-deleted")||C<l.length&&a.nextItemOrder==parseInt(r.data("vlsGfOrder")))){q=!0;t.data("vlsGfOrder",c).attr("data-vls-gf-order",c);++c;for(var G=0;G<f.length;++G){var m=b(f[G]),k=parseInt(m.data("vlsGfLevel"))+a.ghostLevel-a.initialLevel,
k=3<k?3:k;m.data("vlsGfOrder",c).attr("data-vls-gf-order",c).data("vlsGfLevel",k).attr("data-vls-gf-level",k).data("vlsGfPosition",k).attr("data-vls-gf-position",a.ghostPosition).removeClass("level-1 level-2 level-3 level-4 level-5 level-6 level-7").addClass("level-"+k).css("top",a.$draggingGhost.css("top"));++c}}C<l.length&&r.data("vlsGfOrder",c).attr("data-vls-gf-order",c)}t.css({left:"0px",top:a.$draggingGhost.css("top")}).removeClass("ui-draggable-dragging level-1 level-2 level-3 level-4 level-5 level-6 level-7").addClass("level-"+
a.ghostLevel).data("vlsGfPosition",a.ghostPosition).attr("data-vls-gf-position",a.ghostPosition).data("vlsGfLevel",a.ghostLevel).attr("data-vls-gf-level",a.ghostLevel);e.find("li").removeClass("vls-gf-dragging-child").draggable("enable");a.$draggedItem=null;a.ghostPosition=-1;a.items=[];a.$draggingGhost.remove();h()}function v(){var a=b(this);a.hasClass("ui-draggable-dragging")||a.hasClass("ui-draggable-placing")||(a.hasClass("folder")?p(a):a.hasClass("album")&&0<a.data("vlsGfId")&&(A.find(".wp-ui-highlight").remove(),
a.append('<span class="wp-ui-highlight">'),VLS_GF.GalleryManager.switchAlbum("album",a.data("vlsGfId"),a.find(".vls-gf-label").text(),a.data("vlsGfShortcode"))));return!1}function D(a){var d=b(this).closest("li");VLS_GF.GalleryManager.showNameDialog("rename",function(){var a=b(".vls-gf-modal").first().find("input").val();a&&""!=a?(d.find(".vls-gf-label").text(a),d.data("vlsGfIsRenamed","true").attr("data-vls-gf-is-renamed","true"),VLS_GF.GalleryManager.closePopup()):alert("Name must be entered")});
return!1}function y(a){var d="",c="";"vls-gf-btn-add-new-folder"==a.target.id?(d="folder",c="createFolder"):(d="album",c="createAlbum");VLS_GF.GalleryManager.showNameDialog(c,function(){var a=b(".vls-gf-modal").first().find("input").val();if(a&&""!=a){var c=e.find("li"),f=0;0<c.length&&(f=parseInt(c.sort(function(d,a){return parseInt(b(d).data("vlsGfOrder"))-parseInt(b(a).data("vlsGfOrder"))}).last().data("vlsGfOrder")));a=b('<li class="'+d+' level-1"><a href="#"><span class="vls-gf-icon"></span><span class="vls-gf-label">'+
a+'</span></a><span class="btn btn-delete"></span><span class="btn btn-rename"></span></li>');a.data("vlsGfId",0).attr("data-vls-gf-id",0).data("vlsGfLevel",1).attr("data-vls-gf-level",1).data("vlsGfOrder",f+1).attr("data-vls-gf-order",f+1).data("vlsGfPosition",99999).attr("data-vls-gf-position",99999).data("vlsGfIsAdded","true").attr("data-vls-gf-is-added","true").css("top",e.height()-28+"px");e.append(a);a.bind("click.vls-gf",v);a.find(".btn-rename").on("click.vls-gf touchend.vls-gf",D);a.find(".btn-delete").on("click.vls-gf touchend.vls-gf",
H);E();h();VLS_GF.GalleryManager.closePopup()}else alert("Name must be entered")})}function H(){var a="",d=b(this).closest("li"),a=d.hasClass("album")?vlsGfGalleryAdminData.l10n.strConfirmDeleteAlbumMessage.replace("%1$s",d.find(".vls-gf-label").text()):vlsGfGalleryAdminData.l10n.strConfirmDeleteFolderMessage.replace("%1$s",d.find(".vls-gf-label").text());VLS_GF.GalleryManager.showConfirmDialog(vlsGfGalleryAdminData.l10n.strConfirmDeleteHeader,a,vlsGfGalleryAdminData.l10n.strDeleteFolderAction,function(){var a=
0;e.find("li").not(".vls-gf-deleted").sort(function(a,d){return parseInt(b(a).data("vlsGfOrder"))-parseInt(b(d).data("vlsGfOrder"))}).each(function(){var e=b(this);if(e.is(d))a=parseInt(e.data("vlsGfLevel"));else if(0<a){var c=parseInt(e.data("vlsGfLevel"));if(c>a)e.addClass("vls-gf-deleted").data("vlsGfLevel",c-a+1).attr("data-vls-gf-level",c-a+1).data("vlsGfPosition",99999).attr("data-vls-gf-position",99999);else return!1}});d.addClass("vls-gf-deleted").data("vlsGfLevel",1).attr("data-vls-gf-level",
1).data("vlsGfIsDeleted","true").attr("data-vls-gf-is-deleted","true").data("vlsGfPosition",99999).attr("data-vls-gf-position",99999);h();VLS_GF.GalleryManager.closePopup();return!1});return!1}function I(a){if(0<e.find(".vls-gf-loading-overlay").length)return!1;A.addClass("vls-gf-edit-mode");b(this).css("display","none");b("#vls-gf-panel-edit-gallery-tree").css("display","block");var d=e.find("li");d.append('<span class="btn btn-delete"></span><span class="btn btn-rename"></span>');d.find(".btn-rename").on("click.vls-gf touchend.vls-gf",
D);d.find(".btn-delete").on("click.vls-gf touchend.vls-gf",H);E();a.preventDefault()}function z(a){e.find("li").draggable("destroy").find(".btn").remove();b("#vls-gf-panel-edit-gallery-tree").css("display","none");b("#vls-gf-btn-edit-gallery-tree").css("display","block");e.append('<div class="vls-gf-loading-overlay"><span></span></div>');A.removeClass("vls-gf-edit-mode");if("vls-gf-btn-gallery-tree-commit"==a.target.id){var d=[];e.find("li").each(function(){var a=b(this),e="",c="",f="",k="",u="";
a.data("vlsGfIsAdded")&&(f=a.data("vlsGfIsAdded"));a.data("vlsGfIsRenamed")&&(k=a.data("vlsGfIsRenamed"));a.data("vlsGfIsDeleted")&&(u=a.data("vlsGfIsDeleted"));f&&(c=a.hasClass("album")?"album":"folder");if(f||k)e=a.find(".vls-gf-label").text();d.push({id:parseInt(a.data("vlsGfId")),type:c,order:parseInt(a.data("vlsGfOrder")),level:parseInt(a.data("vlsGfLevel")),name:e,is_added:f,is_renamed:k,is_deleted:u})});b.post(ajaxurl,{action:"vls_gf_commit_gallery_tree_changes",security:vlsGfGalleryAdminData.nonce,
itemData:JSON.stringify(d)},function(a){g()},"json")}else g();return!1}function E(){e.find("li").draggable({distance:2,addClasses:!1,cursor:"move",cancel:".btn",start:c,drag:m,revert:k,stop:x})}function n(a,d){var e=d.helper.data("sourceAlbum"),c;c=b(a.target).hasClass("unsorted")?0:parseInt(b(a.target).data("vlsGfId"));var k=d.helper.data("draggedImages");e!==c&&b.post(ajaxurl,{action:"vls_gf_move_images_to_album",security:vlsGfGalleryAdminData.nonce,images:JSON.stringify(k),source_album:e,target_album:c},
VLS_GF.GalleryManager.reloadTab)}var A,e,a={$draggedItem:null,$draggingGhost:b('<div class="dragging-ghost"><div></div></div>'),itemTreeOffset:{top:0,bottom:0},currentArea:{top:0,bottom:0,left:0,right:0},initialLevel:0,nextItemOrder:99999,hoverTimeout:{},ghostPosition:-1,ghostLevel:0},w={height:28,middle:14,topPart:11,bottomPart:18};return{init:function(){A=b(".vls-gf-gallery-manager-container .vls-gf-navigation-panel");e=b("#vls-gf-gallery-tree");A.find("ul.vls-gf-fixed-items a").on("click.vls-gf touchend.vls-gf",
function(a){var d=b(this);A.find("ul>li>span.wp-ui-highlight").remove();d.parent().append('<span class="wp-ui-highlight">');d=d.attr("href").replace("#","");VLS_GF.GalleryManager.switchAlbum(d,0);a.preventDefault();return!1});b("#vls-gf-btn-edit-gallery-tree").on("click.vls-gf touchend.vls-gf",I);b("#vls-gf-btn-gallery-tree-commit, #vls-gf-btn-gallery-tree-cancel").on("click.vls-gf touchend.vls-gf",z);b("#vls-gf-btn-add-new-folder, #vls-gf-btn-add-new-album").on("click.vls-gf touchend.vls-gf",y);
g()},loadGalleryTree:g}}(jQuery);
VLS_GF.AlbumOverviewPanelModule=function(b){function g(g){b(".vls-gf-tab-view").empty().append(g);k=b(".vls-gf-tab-view .vls-gf-image-panel");g={thumb_width:140,thumb_height:140,sortable:!0,dragdrop:!0,views:{list:!1,thumbs:!0,active:"thumbs"},multipart_params:{action:"vls_gf_async_upload",album_id:m},flash_swf_url:"/plupload/js/Moxie.swf",silverlight_xap_url:"/plupload/js/Moxie.xap",stop:function(){VLS_GF.GalleryManager.reloadTab()},complete:function(){VLS_GF.GalleryManager.reloadTab()}};var D={action:"vls_gf_async_upload",
album_id:m};b.extend(D,vls_plupload_setup_object.multipart_params);b.extend(g,vls_plupload_setup_object);g.multipart_params=D;b("#vls-gf-upload-panel").plupload(g);b("#vls-gf-upload-image-button").on("click.vls-gf",function(c){b(".vls-gf-toolbar").slideUp();b("#vls-gf-upload-panel").slideDown();c.preventDefault()});b("#vls-gf-upload-panel .plupload_cancel").on("click.vls-gf",function(c){b("#vls-gf-upload-panel").slideUp();b(".vls-gf-toolbar").slideDown()});b("#vls-gf-bulk-select-start-button").on("click.vls-gf",
function(c){k.addClass("select-mode");b("#vls-gf-toolbar-image-overview").fadeOut();b("#vls-gf-toolbar-bulk-select-left").fadeIn();b("#vls-gf-toolbar-bulk-select-right").fadeIn();c.preventDefault()});b("#vls-gf-bulk-select-cancel-button").on("click.vls-gf",function(c){k.removeClass("select-mode");k.find("li").removeClass("selected").find(".image-icon").remove();b("#vls-gf-toolbar-image-overview").fadeIn();b("#vls-gf-toolbar-bulk-select-left").fadeOut();b("#vls-gf-toolbar-bulk-select-right").fadeOut();
x=null;c.preventDefault()});b("#vls-gf-bulk-select-delete-button").on("click.vls-gf",function(c){var p=[];k.find("li.selected").each(function(){p.push(parseInt(b(this).data("vlsGfImageId")))});b.post(ajaxurl,{action:"vls_gf_delete_images",images:p,album:m},VLS_GF.GalleryManager.reloadTab);x=null;c.preventDefault()});b("#vls-gf-bulk-select-all-button").on("click.vls-gf",function(c){b(".vls-gf-tab-view .vls-gf-image-panel li").not(".selected").addClass("selected").append('<div class="image-icon"><span></span></div>');
x=null;c.preventDefault()});b("#vls-gf-bulk-select-none-button").on("click.vls-gf",function(c){b(".vls-gf-tab-view .vls-gf-image-panel li.selected").removeClass("selected").find(".image-icon").remove();x=null;c.preventDefault()});b("#vls-gf-bulk-select-invert-button").on("click.vls-gf",function(c){b(".vls-gf-tab-view .vls-gf-image-panel li").each(function(){var c=b(this);c.hasClass("selected")?c.removeClass("selected").find(".image-icon").remove():c.addClass("selected").append('<div class="image-icon"><span></span></div>')});
x=null;c.preventDefault()});k.find("li").on("click.vls-gf",function(c){var m=b(this),p=m.data("vlsGfImageId"),g=m.data("vlsGfLinkId"),g=g?g:0;if(k.hasClass("select-mode")){if(c.shiftKey&&x){var h=p=k.find("li").index(x),n=k.find("li").index(m);n<h&&(h=n,n=p);var v=x.hasClass("selected")?"select":"deselect";k.find("li").each(function(){var a=b(this),c=k.find("li").index(a);c>=h&&c<=n&&("select"===v?a.addClass("selected").append('<div class="image-icon"><span></span></div>'):"deselect"===v&&a.removeClass("selected").find(".image-icon").remove())})}else m.hasClass("selected")?
m.removeClass("selected").find(".image-icon").remove():m.addClass("selected").append('<div class="image-icon"><span></span></div>');x=m}else{var e=[],a=[];k.find("li").each(function(){e.push(parseInt(b(this).data("vlsGfImageId")));var c=b(this).data("vlsGfLinkId");a.push(parseInt(void 0==c?0:c))});VLS_GF.ImageDetailsModule.showImageDetailsDialog(p,g,e,a)}c.preventDefault()});k.find("li").draggable({delay:100,cursor:"none",helper:h,cursorAt:{top:20,left:20},appendTo:"body",addClasses:!1,start:p,stop:c})}
function h(){k.hasClass("select-mode")||b(this).addClass("selected");var c=[];k.find("li.selected").each(function(){c.push(parseInt(b(this).data("vlsGfImageId")))});var p=b('<div id="vls-gf-image-drag-helper">'+c.length+"</div>");p.data("draggedImages",c);p.data("sourceAlbum",m);return p}function p(){b(".vls-gf-gallery-manager-container .vls-gf-navigation-panel").addClass("drop-ready");b(this).addClass("dragging-image")}function c(){b(".vls-gf-gallery-manager-container .vls-gf-navigation-panel").removeClass("drop-ready");
b(this).removeClass("dragging-image");k.hasClass("select-mode")||b(this).removeClass("selected")}var m,k,x;return{loadContent:function(c,k){m=k;b.get(ajaxurl,{action:"vls_gf_view_album_overview",item_type:c,album_id:k,tour:VLS_GF.TourModule&&VLS_GF.TourModule.isActive()},g,"html")}}}(jQuery);
VLS_GF.AlbumLayoutPanelModule=function(b){var g,h,p,c,m,k;function x(c){f.layoutType="";q=b(".vls-gf-tab-view").first();q.empty().append(c.view);t=q.find(".vls-gf-tab-container-layout > div");l=q.find(".vls-gf-tab-container-side form");q.find(".vls-gf-x-1-1").on("click.vls-gf",function(a){v(1);a.preventDefault()});q.find(".vls-gf-x-1-2").on("click.vls-gf",function(a){v(.5);a.preventDefault()});q.find(".vls-gf-x-1-4").on("click.vls-gf",function(a){v(.25);a.preventDefault()});q.find(".vls-gf-btn-save-layout").on("click.vls-gf",
function(b){a();b.preventDefault()});l.find("input, select").on("change.vls-gf",function(){D();v(0)});D();v(1);t.find("li").draggable({containment:t,scroll:!0,cursor:"move",addClasses:!1,start:H,drag:I,stop:function(a,c){F.fadeOut(500,function(){b(this).detach()});d.editedItem=null;w();A()}})}function v(a){0<a&&(g=a);q.find(".vls-gf-x-1-1").removeClass("vls-gf-active");q.find(".vls-gf-x-1-2").removeClass("vls-gf-active");q.find(".vls-gf-x-1-4").removeClass("vls-gf-active");h=Math.round(t.parent().width()*
g);.25>=g?(t.css("width","25%"),q.find(".vls-gf-x-1-4").addClass("vls-gf-active")):.5>=g?(t.css("width","50%"),q.find(".vls-gf-x-1-2").addClass("vls-gf-active")):(t.css("width","100%"),q.find(".vls-gf-x-1-1").addClass("vls-gf-active"));p=Math.floor(f.horizontalSpacing*g);c=Math.floor(f.verticalSpacing*g);m=Math.floor((h-p*(f.columnCount-1))/f.columnCount);k=Math.floor(m/f.aspectRatio);w();A()}function D(){var a=f.layoutType;f.layoutType=l.find("#vls-gf-param-layout-type").val();var b="";"metro"==
f.layoutType?(f.columnCount=parseInt(l.find("#vls-gf-param-metro-column-count").val()),b=l.find("#vls-gf-param-metro-aspect-ratio").val(),f.horizontalSpacing=parseInt(l.find("#vls-gf-param-metro-horizontal-spacing").val()),f.verticalSpacing=parseInt(l.find("#vls-gf-param-metro-vertical-spacing").val())):"grid"==f.layoutType&&(f.columnCount=parseInt(l.find("#vls-gf-param-grid-column-count").val()),b=l.find("#vls-gf-param-grid-aspect-ratio").val(),f.horizontalSpacing=parseInt(l.find("#vls-gf-param-grid-horizontal-spacing").val()),
f.verticalSpacing=parseInt(l.find("#vls-gf-param-grid-vertical-spacing").val()));b=b.replace(",",".");b=b.replace(":","/");b=b.replace("-","/");b=b.split("/");f.aspectRatio=parseFloat(b[0]);1<b.length&&(f.aspectRatio=Math.round(f.aspectRatio/parseFloat(b[1])*1E3)/1E3);.25>f.aspectRatio&&(f.aspectRatio=.25);4<f.aspectRatio&&(f.aspectRatio=4);0>f.horizontalSpacing&&(f.horizontalSpacing=0);100<f.horizontalSpacing&&(f.horizontalSpacing=100);0>f.verticalSpacing&&(f.verticalSpacing=0);100<f.verticalSpacing&&
(f.verticalSpacing=100);"grid"==f.layoutType?(l.find("#vls-gf-param-grid-horizontal-spacing").val(f.horizontalSpacing.toString()),l.find("#vls-gf-param-grid-vertical-spacing").val(f.verticalSpacing.toString()),l.find("#vls-gf-param-grid-aspect-ratio").val(f.aspectRatio.toString())):"metro"==f.layoutType&&(l.find("#vls-gf-param-metro-horizontal-spacing").val(f.horizontalSpacing.toString()),l.find("#vls-gf-param-metro-vertical-spacing").val(f.verticalSpacing.toString()),l.find("#vls-gf-param-metro-aspect-ratio").val(f.aspectRatio.toString()));
a!=f.layoutType&&(t.find("li.ui-resizable").resizable("destroy"),"metro"==f.layoutType?(l.find("#vls-gf-parameters-metro").css("display","block"),l.find("#vls-gf-parameters-grid").css("display","none"),t.find("li").resizable({handles:"all",autoHide:!1,minHeight:43,minWidth:43,start:z,resize:E,stop:n})):"grid"==f.layoutType?(l.find("#vls-gf-parameters-metro").css("display","none"),l.find("#vls-gf-parameters-grid").css("display","block")):(l.find("#vls-gf-parameters-metro").css("display","none"),l.find("#vls-gf-parameters-grid").css("display",
"none")))}function y(a,b){return"x"+("00000"+a).slice(-5)+"y"+("00000"+b).slice(-5)}function H(a,c){var e=b(this);F.css({width:e.css("width"),height:e.css("height"),top:e.css("top"),left:e.css("left")});t.append(F);F.fadeIn(300);e.data("vlsGfMetroW")?d.metroSize.width=parseInt(e.data("vlsGfMetroW")):d.metroSize.width=1;e.data("vlsGfMetroH")?d.metroSize.height=parseInt(e.data("vlsGfMetroH")):d.metroSize.height=1;d.centerShift={x:Math.ceil(m/2),y:Math.ceil(k/2)};d.position={x:c.position.left,y:c.position.top};
d.editedItem=e;w();I(a,c)}function I(a,b){d.position={x:b.position.left+d.centerShift.x,y:b.position.top+d.centerShift.y};if(d.position.x<d.currentArea.left||d.position.x>d.currentArea.right||d.position.y<d.currentArea.top||d.position.y>d.currentArea.bottom)d.currentArea.col=Math.floor(d.position.x/(m+p)),d.currentArea.row=Math.floor(d.position.y/(k+c)),d.currentArea.left=d.currentArea.col*(m+p)-p,d.currentArea.right=(d.currentArea.col+1)*(m+p),d.currentArea.top=d.currentArea.row*(k+c)-c,d.currentArea.bottom=
(d.currentArea.row+1)*(k+c),A()}function z(a,c){var e=b(this);F.css({width:e.css("width"),height:e.css("height"),top:e.css("top"),left:e.css("left")});e.closest("div").append(F);F.fadeIn(300);e.data("vlsGfMetroW")?d.metroSize.width=parseInt(e.data("vlsGfMetroW")):d.metroSize.width=1;d.originalState.width=d.metroSize.width;e.data("vlsGfMetroH")?d.metroSize.height=parseInt(e.data("vlsGfMetroH")):d.metroSize.height=1;d.originalState.height=d.metroSize.height;e.data("vlsGfCol")?d.originalState.col=parseInt(e.data("vlsGfCol")):
d.originalState.col=0;e.data("vlsGfRow")?d.originalState.row=parseInt(e.data("vlsGfRow")):d.originalState.row=0;d.centerShift={x:Math.ceil(m/2),y:Math.ceil(k/2)};d.position={x:c.position.left,y:c.position.top};d.editedItem=e;w();E(a,c)}function E(a,b){var e=Math.floor((b.size.width-Math.floor(.2*m))/(m+p))+1,f=Math.floor((b.size.height-Math.floor(.2*k))/(k+c))+1;if(e!==d.metroSize.width||f!==d.metroSize.height)d.metroSize.width=e,d.metroSize.height=f,d.currentArea.col=b.originalPosition.left===b.position.left?
d.originalState.col:d.originalState.col+d.originalState.width-e,d.currentArea.row=b.originalPosition.top===b.position.top?d.originalState.row:d.originalState.row+d.originalState.height-f,A()}function n(a,c){F.fadeOut(500,function(){b(this).detach()});d.editedItem=null;w();A()}function A(){switch(f.layoutType){case "metro":a:{var a=d.itemsList,r=0,l=0,u,g,h=[],w=0,n=0,q=0,v=0,x=0;if(d.editedItem){if(d.currentArea.col+d.metroSize.width>f.columnCount)break a;for(r=0;r<d.metroSize.width;++r)for(l=0;l<
d.metroSize.height;++l)h.push(y(d.currentArea.col+r,d.currentArea.row+l));for(g=!1;!g;)0>b.inArray(y(n,w),h)?g=!0:(++n,n>=f.columnCount&&(n=0,++w));F.css({width:d.metroSize.width*(m+p)-p+"px",height:d.metroSize.height*(k+c)-c+"px",left:d.currentArea.col*(m+p)+"px",top:d.currentArea.row*(k+c)+"px"});d.editedItem.data("vlsGfCol",d.currentArea.col);d.editedItem.data("vlsGfRow",d.currentArea.row);d.editedItem.data("vlsGfMetroW",d.metroSize.width);d.editedItem.attr("data-vls-gf-metro-w",d.metroSize.width);
d.editedItem.data("vlsGfMetroH",d.metroSize.height);d.editedItem.attr("data-vls-gf-metro-h",d.metroSize.height);x<d.currentArea.row+d.metroSize.height-1&&(x=d.currentArea.row+d.metroSize.height-1)}for(u=0;u<a.length;++u){var B=a[u];B.width>f.columnCount&&(B.width=f.columnCount);g=!1;v=n;for(q=w;!g;){g=!0;for(r=0;r<B.width;++r)for(l=0;l<B.height;++l)if(v+r>=f.columnCount||0<=b.inArray(y(v+r,q+l),h))g=!1;g||(++v,v>=f.columnCount&&(v=0,++q))}for(r=0;r<B.width;++r)for(l=0;l<B.height;++l)h.push(y(v+r,
q+l));r=(m+p)*v;l=(k+c)*q;B.element.css("width",B.width*m+(B.width-1)*p+"px").css("height",B.height*k+(B.height-1)*c+"px").css("top",l+"px").css("left",r+"px");B.element.data("vlsGfCol",v);B.element.data("vlsGfRow",q);x<q+B.height-1&&(x=q+B.height-1);for(g=!1;!g;)0>b.inArray(y(n,w),h)?g=!0:(++n,n>=f.columnCount&&(n=0,++w))}t.find("ul").css("height",(x+1)*k+x*c)}break;case "grid":e(f)}}function e(){var a=[],e=0,l=0,g,u=0,h=0,n=0;t.find("li").css("width",m+"px").css("height",k+"px").each(function(){var c=
b(this),e=0,f=0,l=0;d.editedItem&&(c.hasClass("ui-draggable-dragging")||c.hasClass("ui-resizable-resizing"))||(c.data("vlsGfCol")&&(e=parseInt(c.data("vlsGfCol"))),c.data("vlsGfRow")&&(f=parseInt(c.data("vlsGfRow"))),c.data("vlsGfLinkId")&&(l=parseInt(c.data("vlsGfLinkId"))),a.push({element:c,row:f,col:e,linkId:l}))});a.sort(function(a,b){return 100*a.row+a.col-100*b.row-b.col});d.editedItem&&(F.css({left:d.currentArea.col*(m+p)+"px",top:d.currentArea.row*(k+c)+"px"}),d.editedItem.data("vlsGfCol",
d.currentArea.col),d.editedItem.data("vlsGfRow",d.currentArea.row),n<d.currentArea.row&&(n=d.currentArea.row));for(g=h=u=0;g<a.length;++g){var w=a[g];d.editedItem&&d.currentArea.col==h&&d.currentArea.row==u&&(++h,h>=f.columnCount&&(h=0,++u));e=(m+p)*h;l=(k+c)*u;w.element.css("top",l+"px").css("left",e+"px");w.element.data("vlsGfCol",h).attr("data-vls-gf-col",h);w.element.data("vlsGfRow",u).attr("data-vls-gf-row",u);n<u&&(n=u);++h;h>=f.columnCount&&(h=0,++u)}t.find("ul").css("height",(n+1)*k+n*c)}
function a(){var a=b(this);if(!a.hasClass("vls-gf-processing")){a.addClass("vls-gf-processing");var d={layout_type:f.layoutType,column_count:f.columnCount,aspect_ratio:f.aspectRatio,horizontal_spacing:f.horizontalSpacing,vertical_spacing:f.verticalSpacing},c=[];t.find("li").each(function(){var a=b(this);c.push({link_id:a.data("vlsGfLinkId"),col:a.data("vlsGfCol"),row:a.data("vlsGfRow"),metro_w:a.data("vlsGfMetroW"),metro_h:a.data("vlsGfMetroH")})});b.post(ajaxurl,{action:"vls_gf_update_album_layout",
security:vlsGfGalleryAdminData.nonce,album_id:u,options:JSON.stringify(d),images:JSON.stringify(c)},function(d){a.removeClass("vls-gf-processing");b(".vls-gf-update-feedback").show().fadeOut(3E3)})}}function w(){var a=[];t.find("li").each(function(){var c=b(this),e=0,f=0,l=1,k=1;d.editedItem&&(c.hasClass("ui-draggable-dragging")||c.hasClass("ui-resizable-resizing"))||(c.data("vlsGfCol")&&(e=parseInt(c.data("vlsGfCol"))),c.data("vlsGfRow")&&(f=parseInt(c.data("vlsGfRow"))),c.data("vlsGfMetroW")&&(l=
parseInt(c.data("vlsGfMetroW"))),c.data("vlsGfMetroH")&&(k=parseInt(c.data("vlsGfMetroH"))),a.push({element:c,row:f,col:e,width:l,height:k}))});a.sort(function(a,b){return 100*a.row+a.col-100*b.row-b.col});d.itemsList=a}var u,d={editedItem:null,metroSize:{width:1,height:1},centerShift:{x:0,y:0},originalState:{width:1,height:1,col:0,row:0},position:{x:0,y:0},currentArea:{col:0,row:0,left:0,right:0,top:0,bottom:0},itemsList:[]},q,t,l;h=0;g=1;c=p=k=m=0;var f={layoutType:"",columnCount:0,aspectRatio:1,
horizontalSpacing:0,verticalSpacing:0},F=b('<div class="vls-gf-dragging-placeholder"></div>');return{loadContent:function(a){u=a;b.getJSON(ajaxurl,{action:"vls_gf_view_album_layout",album_id:u,tour:VLS_GF.TourModule&&VLS_GF.TourModule.isActive()},x)}}}(jQuery);
VLS_GF.ItemEditPanelModule=function(b){function g(g){b(".vls-gf-tab-view").empty().append(g.view);b("#vls-gf-item-details button.button-primary").on("click.vls-gf",h)}function h(g){g.preventDefault();var c=b("#vls-gf-item-details"),h=c.find("button.button-primary");if(!h.hasClass("disabled")){h.addClass("disabled");c.find(".vls-gf-update-feedback").hide();var k={action:"vls_gf_update_album_details"};c.find("input, select, textarea").each(function(){k[this.name]=this.value});b.post(ajaxurl,k,function(){h.removeClass("disabled");
c.find(".vls-gf-update-feedback").show().fadeOut(3E3)})}}return{loadContent:function(h,c){b.getJSON(ajaxurl,{action:"vls_gf_view_gallery_item_edit",item_type:h,item_id:c,tour:VLS_GF.TourModule&&VLS_GF.TourModule.isActive()},g)}}}(jQuery);
VLS_GF.ImageDetailsModule=function(b){var g,h,p,c;function m(){var c=b(this).closest(".vls-gf-modal");if(c.hasClass("vls-gf-busy"))return!1;var a=c.data("vlsGfImages"),k=c.data("vlsGfLinks"),g=c.data("vlsGfCurrentImage"),g=a.indexOf(g);0<g&&(g--,c.data("vlsGfCurrentImage",a[g]),x(a[g],k[g]))}function k(){var c=b(this).closest(".vls-gf-modal");if(c.hasClass("vls-gf-busy"))return!1;var a=c.data("vlsGfImages"),g=c.data("vlsGfLinks"),k=c.data("vlsGfCurrentImage"),k=a.indexOf(k);k<a.length-1&&(k++,c.data("vlsGfCurrentImage",
a[k]),x(a[k],g[k]))}function x(c,a){z.addClass("vls-gf-busy");b.getJSON(ajaxurl,{action:"vls_gf_view_image_details",image_id:c,link_id:a},function(a){v(a);z.removeClass("vls-gf-busy")})}function v(e){z.find(".vls-gf-content").empty().append(e.view);E=z.find(".vls-gf-image-panel .vls-gf-image-edit-overlay");e=E.find(".vls-gf-crop-mask");g=parseFloat(e.data("vlsGfTop")?e.data("vlsGfTop"):0);h=parseFloat(e.data("vlsGfRight")?e.data("vlsGfRight"):0);p=parseFloat(e.data("vlsGfBottom")?e.data("vlsGfBottom"):
0);c=parseFloat(e.data("vlsGfLeft")?e.data("vlsGfLeft"):0);e.resizable({containment:E,handles:"all",autoHide:!1,minHeight:43,minWidth:43,stop:function(a,b){I()}});e.draggable({containment:E,distance:2,addClasses:!1,cursor:"move",stop:function(a,b){I()}});b(window).on("resize.vls-gf-image-details",function(a){b(a.target).hasClass("ui-resizable")||H();return!1});z.find(".vls-gf-options-panel input.button-primary").on("click.vls-gf",D)}function D(){var e=z.find(".vls-gf-options-panel input.button-primary");
if(!e.hasClass("vls-gf-busy")){e.addClass("vls-gf-busy");var a={action:"vls_gf_update_image_details",crop_top:g,crop_right:h,crop_bottom:p,crop_left:c};z.find("form input, form select, form textarea").each(function(){this.name&&(a[this.name]=this.value)});b.post(ajaxurl,a,function(a){e.removeClass("vls-gf-busy");z.find(".vls-gf-update-feedback").show().fadeOut(3E3)})}}function y(){b(window).off("resize.vls-gf-image-details");var c=b(".vls-gf-modal");c.find(".ui-resizable").resizable("destroy").draggable("destroy");
c.remove();A&&VLS_GF.GalleryManager.reloadTab()}function H(){var e=b(".vls-gf-image-details-dialog .vls-gf-image-panel img"),a=b(".vls-gf-image-details-dialog .vls-gf-image-panel .vls-gf-image-edit-overlay");n.width=e.width();n.height=e.height();a.css({width:n.width,height:n.height});a.find(".vls-gf-crop-mask").css({top:Math.round(n.height*g*.01)+"px",left:Math.round(n.width*c*.01)+"px",width:Math.round(n.width-n.width*c*.01-n.width*h*.01)+"px",height:Math.round(n.height-n.height*g*.01-n.height*p*
.01)+"px"})}function I(){var e=b(".vls-gf-image-details-dialog .vls-gf-image-panel .vls-gf-crop-mask"),a=e.position(),k=e.width(),e=e.height();g=a.top/n.height*100;h=(n.width-a.left-k)/n.width*100;p=(n.height-a.top-e)/n.height*100;c=a.left/n.width*100;A=!0}var z,E,n={width:0,height:0};c=p=h=g=0;var A=!1;return{showImageDetailsDialog:function(c,a,g,h){var d=b('<div class="vls-gf-modal"><div class="vls-gf-backdrop"></div><div class="vls-gf-image-details-dialog"></div></div>');d.data("vlsGfImages",g).data("vlsGfLinks",
h).data("vlsGfCurrentImage",c);b("#wpwrap").append(d);z=d.find(".vls-gf-image-details-dialog");h=b("<div />").addClass("vls-gf-title").append(b("<span/>").text(vlsGfGalleryAdminData.l10n.strImageDetails));z.append(h);g=b("<div />").addClass("vls-gf-window-controls");h.append(g);h=b("<button/>").addClass("vls-gf-btn-prev").text("<");h.on("click.vls-gf",m);g.append(h);h=b("<button/>").addClass("vls-gf-btn-next").text(">");h.on("click.vls-gf",k);g.append(h);h=b("<button/>").addClass("vls-gf-btn-cancel").text("\u00d7");
h.on("click.vls-gf",y);g.append(h);z.append('<div class="vls-gf-content"></div>');x(c,a)},updateOverlaySize:H}}(jQuery);jQuery(document).ready(function(){VLS_GF.TourModule&&VLS_GF.TourModule.start();VLS_GF.GalleryManager.init()});
